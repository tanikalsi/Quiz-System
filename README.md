# Quiz System – Spring Boot Microservices

A microservices-based quiz platform built with Spring Boot, Spring Cloud, Eureka Service Discovery, and JWT-based authentication.
The system exposes REST APIs for user management and quiz management, fronted by an API Gateway, and includes a console-based client for teachers and students.

---

## Architecture Overview

**Services:**

- **Eureka Server** (`eureka-server`)
  - Service discovery for all other services.
  - Runs on port **8761**.

- **API Gateway** (`api-gateway`)
  - Spring Cloud Gateway acting as a single entry point.
  - Routes traffic to `USER-SERVICE` and `QUIZ-SERVICE` via Eureka.
  - Runs on port **8080**.

- **User Service** (`user-service`)
  - Manages users, roles (TEACHER/STUDENT), and authentication.
  - Issues **JWT tokens** for authenticated users.
  - Uses **MySQL** (`user_db`) via Spring Data JPA.
  - Runs on port **9001**.

- **Quiz Service** (`quiz-service`)
  - Manages quizzes, questions, and quiz results.
  - Validates submissions and calculates scores.
  - Uses **MySQL** (`quiz_db`) via Spring Data JPA.
  - Protected by JWT (tokens generated by `user-service`).
  - Runs on port **9002**.

- **Quiz Console Client** (`quiz-console-client`)
  - Interactive console/terminal application.
  - Uses the **API Gateway** to talk to user and quiz services.
  - Provides teacher and student menus:
    - Teachers: create quizzes, add questions, list quizzes.
    - Students: view quizzes, take quizzes, view past scores.

---

## Project Structure

```text
Quiz-System/
  api-gateway/
    src/main/java/com/quizsystem/api_gateway/...
    src/main/resources/application.properties
    pom.xml
  eureka-server/
    src/main/java/com/quizsystem/eureka_server/...
    src/main/resources/application.properties
    pom.xml
  quiz-service/
    src/main/java/com/quizsystem/quiz_service/...
    src/main/resources/application.properties
    pom.xml
  user-service/
    src/main/java/com/quizsystem/user_service/...
    src/main/resources/application.properties
    pom.xml
  quiz-console-client/
    src/main/java/com/quizsystem/quiz_console_client/...
    src/main/resources/application.properties
    pom.xml
```

---

## Technology Stack

- **Language:** Java 17
- **Frameworks:**
  - Spring Boot 3.x
  - Spring Web
  - Spring Data JPA
  - Spring Security
  - Spring Cloud (Eureka, Gateway, Netflix client)
- **Security:** JWT (JSON Web Tokens)
- **Databases:** MySQL (separate DBs for users and quiz data)
- **Build Tool:** Maven

---

## Prerequisites

- **Java 17** installed and on your `PATH`.
- **Maven** installed (`mvn` command available).
- **MySQL 8+** running locally (default configuration expects `localhost:3306`).

You can customize credentials and DB names in each service’s `application.properties`.

---

## Configuration

### 1. Eureka Server

`eureka-server/src/main/resources/application.properties`:

- Application name: `EUREKA-SERVER`
- Port: `8761`
- Does not register itself as a client.

### 2. API Gateway

`api-gateway/src/main/resources/application.properties`:

- Application name: `API-GATEWAY`
- Port: `8080`
- Routes:
  - User Service:
    - **Route ID:** `user-service-route`
    - **URI:** `lb://USER-SERVICE`
    - **Incoming Path (client):** `/USER-SERVICE/**`
    - **Strips prefix** so forwarded paths are `/api/users/...`.
  - Quiz Service:
    - **Route ID:** `quiz-service-route`
    - **URI:** `lb://QUIZ-SERVICE`
    - **Incoming Path (client):** `/QUIZ-SERVICE/**`
    - **Strips prefix** so forwarded paths are `/quiz/...` or `/results/...`.
- Eureka client configuration to point to `http://localhost:8761/eureka`.

### 3. User Service

`user-service/src/main/resources/application.properties`:

- Application name: `USER-SERVICE`
- Port: `9001`
- Eureka client: `http://localhost:8761/eureka`
- MySQL:
  ```properties
  spring.datasource.url=jdbc:mysql://localhost:3306/user_db
  spring.datasource.username=root
  spring.datasource.password=taran
  spring.jpa.hibernate.ddl-auto=update
  spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
  ```
- Logging levels for debugging security and controller behavior.

**Important:**
- Change the DB username/password for your environment.
- JWT secret is defined in `user-service/src/main/java/com/quizsystem/user_service/util/JwtUtil.java` and **must match** the secret in quiz-service.

### 4. Quiz Service

`quiz-service/src/main/resources/application.properties`:

- Application name: `QUIZ-SERVICE`
- Port: `9002`
- Eureka client: `http://localhost:8761/eureka`
- MySQL:
  ```properties
  spring.datasource.url=jdbc:mysql://localhost:3306/quiz_db
  spring.datasource.username=root
  spring.datasource.password=taran
  spring.jpa.hibernate.ddl-auto=update
  spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
  ```

**Important:**
- JWT secret in `quiz-service/src/main/java/com/quizsystem/quiz_service/util/JwtUtil.java` must be the **same** as in the user-service.

---

## Data Model

### User Service

`User` entity (`user-service/src/main/java/com/quizsystem/user_service/model/User.java`):

- `id` – Long (PK).
- `username` – unique, not null.
- `password` – encrypted with BCrypt.
- `role` – string, e.g. `STUDENT` or `TEACHER`.

### Quiz Service

- `Quiz` (`quiz-service/.../model/Quiz.java`):
  - `id` – Long (PK).
  - `title` – quiz name.
  - `description` – short info.
  - `userId` – ID of creator (teacher).
  - `questions` – `List<Question>` (one-to-many).

- `Question` (`quiz-service/.../model/Question.java`):
  - `id` – Long (PK).
  - `questionText`
  - `option1`, `option2`, `option3`, `option4`
  - `correctAnswer`
  - `quiz` – many-to-one reference back to `Quiz`.

- `Result` (`quiz-service/.../model/Result.java`):
  - `id`
  - `quizId`
  - `userId`
  - `score`
  - `totalQuestions`
  - `attemptedOn` – `LocalDateTime`

- `Submission` DTO (`quiz-service/.../model/Submission.java`):
  - `userId`
  - `answers` – `Map<Long, String>`; key = question ID, value = chosen answer text.

---

## Security & Authentication

### JWT Secret

Defined in:

- `user-service/.../util/JwtUtil.java`
- `quiz-service/.../util/JwtUtil.java`

They **must have the same value**, otherwise quiz-service will reject tokens.

### User Service Security

Configured in `user-service/.../config/SecurityConfig.java`:

- **Permitted without auth:**
  - `POST /api/users` – create a new user.
  - `POST /api/users/login` – login and get token.
  - `GET /api/users/test` – basic health/diagnostics.

- **Requires authentication:**
  - All other `/api/users/**` endpoints (e.g. `/api/users/me`).

JWT processing is handled by `JwtRequestFilter` plugged into the Spring Security filter chain.

### Quiz Service Security

Configured in `quiz-service/.../config/SecurityConfig.java`:

- **Permitted without auth:**
  - `GET /quiz` – list all available quizzes.

- **Requires authentication (valid JWT):**
  - `POST /quiz` – create a quiz.
  - `POST /quiz/{quizId}/submit` – submit answers.
  - `/quiz/{quizId}/questions` – add/get questions (by default, all except `GET /quiz` require auth).
  - `/results/**` – fetch results.

Quiz service validates JWT tokens (issued by user-service) using its own `JwtUtil`.

---

## Running the System

### 1. Start MySQL and Create Databases

In MySQL:

```sql
CREATE DATABASE IF NOT EXISTS user_db;
CREATE DATABASE IF NOT EXISTS quiz_db;
```

Make sure credentials in `application.properties` match your MySQL setup.

### 2. Start Eureka Server

```bash
cd eureka-server
mvn spring-boot:run
```

Eureka dashboard will be available at:
`http://localhost:8761/`

### 3. Start User Service

```bash
cd user-service
mvn spring-boot:run
```

Registers itself as `USER-SERVICE` with Eureka and listens on `http://localhost:9001`.

### 4. Start Quiz Service

```bash
cd quiz-service
mvn spring-boot:run
```

Registers as `QUIZ-SERVICE` and listens on `http://localhost:9002`.

### 5. Start API Gateway

```bash
cd api-gateway
mvn spring-boot:run
```

Listens on `http://localhost:8080`.

### 6. Start Quiz Console Client

```bash
cd quiz-console-client
mvn spring-boot:run
```

Runs as a **console** app (non-web). All interactions will be through the terminal.

---

## API Usage

You can call services **directly** or through the **API Gateway**.

### Base URLs

- **Through Gateway:**
  - User endpoints: `http://localhost:8080/USER-SERVICE/api/users/...`
  - Quiz endpoints: `http://localhost:8080/QUIZ-SERVICE/quiz/...`
  - Results endpoints: `http://localhost:8080/QUIZ-SERVICE/results/...`

- **Direct (bypassing Gateway):**
  - User service: `http://localhost:9001/api/users/...`
  - Quiz service: `http://localhost:9002/quiz/...` and `http://localhost:9002/results/...`

### 1. User Service Endpoints

**Create User (Sign Up)**  
`POST /api/users`

Example request:

```bash
curl -X POST http://localhost:8080/USER-SERVICE/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "username": "teacher1",
    "password": "password123",
    "role": "TEACHER"
  }'
```

**Login (Get JWT)**  
`POST /api/users/login`

Request body:

```json
{
  "username": "teacher1",
  "password": "password123"
}
```

Response (simplified):

```json
{
  "jwt": "<JWT_TOKEN_STRING>"
}
```

**Get Current User Details**  
`GET /api/users/me` (requires `Authorization: Bearer <token>`)

```bash
curl http://localhost:8080/USER-SERVICE/api/users/me \
  -H "Authorization: Bearer <JWT_TOKEN_STRING>"
```

### 2. Quiz Service Endpoints

**Get All Quizzes (public)**  
`GET /quiz`

```bash
curl http://localhost:8080/QUIZ-SERVICE/quiz
```

**Create a Quiz (teacher, JWT required)**  
`POST /quiz`

Request body (minimal example):

```json
{
  "title": "Java Basics Quiz",
  "description": "Test your Java fundamentals",
  "userId": 1
}
```

**Add Question to a Quiz (teacher)**  
`POST /quiz/{quizId}/questions`

Example:

```json
{
  "questionText": "What is JVM?",
  "option1": "Java Very Much",
  "option2": "Java Virtual Machine",
  "option3": "Just Virtual Machine",
  "option4": "None of the above",
  "correctAnswer": "Java Virtual Machine"
}
```

**Get Questions for a Quiz**  
`GET /quiz/{quizId}/questions` (JWT required by default config)

**Submit Quiz Answers (student)**  
`POST /quiz/{quizId}/submit`

Body uses the `Submission` DTO:

```json
{
  "userId": 2,
  "answers": {
    "1": "Java Virtual Machine",
    "2": "Some other answer"
  }
}
```

Response is a `Result` object:

```json
{
  "id": 10,
  "quizId": 5,
  "userId": 2,
  "score": 1,
  "totalQuestions": 2,
  "attemptedOn": "2024-01-01T12:34:56"
}
```

**Get User Results**  
`GET /results/user/{userId}`

```bash
curl http://localhost:8080/QUIZ-SERVICE/results/user/2 \
  -H "Authorization: Bearer <JWT_TOKEN_STRING>"
```

---

## Quiz Console Client Usage

When you run `quiz-console-client`, you’ll see menus in the terminal.

### Login Menu

Options:

1. **Login**
2. **Create a new User**
3. **Exit**

Flow:

- **Create a new user** first if none exists.
- Then **Login** with your username/password.
- The client will:
  - Call `USER-SERVICE /login` to get a JWT.
  - Call `USER-SERVICE /me` to load user details.
  - Store your JWT and user in memory.

### Teacher Menu

If logged in as a user with role `TEACHER`:

1. Create a new Quiz
2. Add a Question to a Quiz
3. List all Quizzes
4. Logout

Behind the scenes, these map to calls like:

- `POST /QUIZ-SERVICE/quiz`
- `POST /QUIZ-SERVICE/quiz/{quizId}/questions`
- `GET /QUIZ-SERVICE/quiz`

using the API Gateway and the stored JWT in the `Authorization` header.

### Student Menu

If logged in as a user with role `STUDENT`:

1. View all Quizzes
2. Take a Quiz
3. View My Scores
4. Logout

Logic:

- **View all Quizzes** – calls `GET /QUIZ-SERVICE/quiz`.
- **Take a Quiz**:
  - Fetches questions from `/QUIZ-SERVICE/quiz/{quizId}/questions`.
  - Interactively asks questions in the console.
  - Builds a `Submission` map and posts to `/QUIZ-SERVICE/quiz/{quizId}/submit`.
  - Displays your score.
- **View My Scores** – calls `/QUIZ-SERVICE/results/user/{currentUser.id}` and prints them.

---

## Development Notes

- **Database schema** is managed by Hibernate (`ddl-auto=update`). For production, consider `validate` or using migrations (Flyway/Liquibase).
- **Secrets** (JWT secret, DB passwords) are currently hardcoded for local development. For any real deployment, move these into environment variables or a secrets manager.
- **Ports** are configurable in `application.properties` if you need to avoid conflicts.
- **Logging** in user-service is set to DEBUG for security and web packages to aid debugging during development.

---

## Possible Improvements

- Add comprehensive integration tests for all endpoints.
- Replace hardcoded JWT secret with environment-based configuration.
- Add a web UI frontend (React/Angular/etc.) on top of the existing APIs.
- Externalize route configuration for API Gateway (YAML or config server).
